@Model CUS.Models.CUS
@{
    ViewBag.Title = "Nota de Evolución";

    int edad = 0;
    int meses = 0;
    var fecha = DateTime.Now.ToString("yyyy-MM-ddT00:00:00.000");
    var fechaDT = DateTime.Parse(fecha);

    var today = fechaDT;
    DateTime fnac = (DateTime)Model.FechaNacimiento;
    int Years = 0;
    int Months = 0;
    int Days = 0;

    var nacimiento = string.Format("{0:dd/MM/yyyy}", Model.FechaNacimiento);

    if ((today.Year - fnac.Year) > 0 ||
    (((today.Year - fnac.Year) == 0) && ((fnac.Month < today.Month) ||
    ((fnac.Month == today.Month) && (fnac.Day <= today.Day)))))
    {
        int DaysInBdayMonth = DateTime.DaysInMonth(fnac.Year, fnac.Month);
        int DaysRemain = today.Day + (DaysInBdayMonth - fnac.Day);

        if (today.Month > fnac.Month)
        {
            Years = today.Year - fnac.Year;
            Months = today.Month - (fnac.Month + 1) + Math.Abs(DaysRemain / DaysInBdayMonth);
            Days = (DaysRemain % DaysInBdayMonth + DaysInBdayMonth) % DaysInBdayMonth;
        }
        else if (today.Month == fnac.Month)
        {
            if (today.Day >= fnac.Day)
            {
                Years = today.Year - fnac.Year;
                Months = 0;
                Days = today.Day - fnac.Day;
            }
            else
            {
                Years = (today.Year - 1) - fnac.Year;
                Months = 11;
                Days = DateTime.DaysInMonth(fnac.Year, fnac.Month) - (fnac.Day - today.Day);
            }
        }
        else
        {
            Years = (today.Year - 1) - fnac.Year;
            Months = today.Month + (11 - fnac.Month) + Math.Abs(DaysRemain / DaysInBdayMonth);
            Days = (DaysRemain % DaysInBdayMonth + DaysInBdayMonth) % DaysInBdayMonth;
        }
    }

    if (Years >= 99)
    {
        edad = 99;
    }
    else
    {
        edad = Years;
    }

    meses = Months;
}


<style>
    #container {
        margin-left: -130px;
        position: relative;
        display: inline-block;
        text-align: center;
        color: #EEAA7B;
        font-family: 'Montserrat', sans-serif;
    }

    #scale {
        transform: rotateX(180deg);
        stroke-width: 50;
        fill: none;
    }

    #YAS {
        stroke: #29ce58;
        stroke-dasharray: 471, 943;
    }

    #Yeah {
        stroke: #87d19c;
        stroke-dasharray: 393, 943;
    }

    #Mmkay {
        stroke: #ffd651;
        stroke-dasharray: 315, 943;
    }

    #Ouch {
        stroke: #ef961a;
        stroke-dasharray: 237, 943;
    }

    #Owwwww {
        stroke: #f26d0e;
        stroke-dasharray: 159, 943;
    }

    #AHHHHHHH {
        stroke: #ce2d2d;
        stroke-dasharray: 81, 943;
    }

    #needle {
        fill: #66B9BF;
    }

    .faces {
        position: absolute;
        width: 20%;
        height: 20%;
        top: 37%;
        left: 40%;
    }

        .faces #YAS, .faces #Yeah, .faces #Mmkay, .faces #Owwwww, .faces #AHHHHHHH {
            visibility: hidden;
        }

    #slider, #level {
        position: absolute;
    }

    h1 {
        position: absolute;
        top: 60%;
        left: 0;
        margin: auto;
        right: 0;
        font-size: 1.5em;
    }

    #slider {
        cursor: pointer;
        left: 0;
        margin: auto;
        right: 0;
        top: 70%;
        width: 50%;
        -webkit-appearance: none;
        border-radius: 10px;
        height: 15px;
        background-color: #66B9BF;
    }

        #slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 20px;
            width: 15px;
            border-radius: 3px;
            background: #ffffff;
            cursor: pointer;
        }

        #slider:focus {
            outline: none;
        }

    #level {
        color: black;
        font-size: 15pt;
        font-weight: bold;
        top: 75%;
        width: 50%;
        left: 25%;
        visibility: hidden;
        font-size: .9em;
        color: #EEAA7B;
    }
</style>

<div class="page-wrapper">
    <div class="content container-fluid">
        <div class="row">
            <div class="col-sm-12 p-0">
                <div class="profile-header">
                    <div class="row align-items-center">
                        <div class="col-auto profile-image">
                            <a href="#">
                                @*<img class="rounded-circle" alt="User Image" src="~/Content/assets/img/profiles/avatar-04.jpg">*@
                            </a>
                        </div>
                        <div class="col ml-md-n2 profile-user-info">
                            <h10 style="font-weight:bold;">Nombre: @Model.Nombre @Model.PrimerApellido @Model.SegundoApellido </h10>
                            <a id="Nombre"></a><br />
                            <h10 style="font-weight:bold;">Expediente:@Model.Expediente </h10>
                            <a id="Exp"></a><br />
                            <h10 style="font-weight:bold;">Edad: @edad años @meses meses</h10>
                            <a id="Edad"></a><br />
                            <h10 style="font-weight:bold;">Sexo: @Model.Sexo</h10>
                            <a id="Sexo"></a><br />
                            <h10 style="font-weight:bold;">Fecha Nac.: @nacimiento</h10>
                            <a id="FechaNac"></a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>



    <div class="container-fluid">
        <div class="row" style="background-color:white;">
            <div class="col-12 pl-5 pr-5">
                
                <div class="row m-0">
                    <div class="col-md-4">
                        <h3 class="mt-5"> <b>Escala del Dolor</b></h3>
                        <div id="container">
                            <svg width="500" height="300" viewBox="0 0 800 400" id="scale">
                                <circle id="YAS" r="150" cx="50%" cy="50%">
                                </circle>
                                <circle id="Yeah" r="150" cx="50%" cy="50%"></circle>
                                <circle id="Mmkay" r="150" cx="50%" cy="50%"></circle>
                                <circle id="Ouch" r="150" cx="50%" cy="50%"></circle>
                                <circle id="Owwwww" r="150" cx="50%" cy="50%"></circle>
                                <circle id="AHHHHHHH" r="150" cx="50%" cy="50%"></circle>
                                <polygon id="needle" points="390, 200 410,200 400, 340" />
                            </svg>
                            <h1>¿Cuánto dolor sientes?</h1>
                            <input id="slider" type="range" min="0" max="100" value="50" />
                            <label id="level" id="value">severe</label>
                            <svg class="faces" viewBox="0 0 105 105" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:1.5;">
                            <g id="YAS">
                            <circle id="face_0" cx="52.5" cy="52.5" r="50" style="fill:rgb(33,166,98);" />
                            <path id="mouth_0" d="M36.391,64.422C36.391,64.422 37.32,82.444 52.5,82.19C67.313,81.942 69.171,64.379 69.085,64.268" style="fill:none;stroke:white;stroke-width:5px;" />
                            </g>
                            <g id="Yeah">
                            <circle id="face_1" cx="52.5" cy="52.5" r="50" style="fill:rgb(141,217,149);" />
                            <path id="mouth_1" d="M36.391,64.422C36.391,64.422 37.32,73.785 52.5,73.532C67.313,73.284 69.171,64.379 69.085,64.268" style="fill:none;stroke:white;stroke-width:5px;" />
                            </g>
                            <g id="Mmkay">
                            <circle id="face_2" cx="52.5" cy="52.5" r="50" style="fill:rgb(231,228,122);" />
                            <path id="mouth_2" d="M36.391,64.422C36.391,64.422 37.421,64.423 52.601,64.17C67.414,63.922 69.171,64.379 69.085,64.268" style="fill:none;stroke:white;stroke-width:5px;" />
                            </g>
                            <g id="Ouch">
                            <circle id="face_3" cx="52.5" cy="52.5" r="50" style="fill:rgb(223,149,51);" />
                            <path id="mouth_3" d="M34.293,69.676C34.293,69.676 37.421,64.423 52.601,64.17C67.414,63.922 72.612,69.21 72.526,69.099" style="fill:none;stroke:white;stroke-width:5px;" />
                            </g>
                            <g id="Owwwww">
                            <circle id="face_4" cx="52.5" cy="52.5" r="50" style="fill:rgb(232,103,13);" />
                            <path id="mouth_4" d="M35.202,72.615C35.202,72.615 37.421,64.423 52.601,64.17C67.414,63.922 73.549,70.769 73.949,71.595" style="fill:none;stroke:white;stroke-width:5px;" />
                            </g>
                            <g id="AHHHHHHH">
                            <circle id="face_5" cx="52.5" cy="52.5" r="50" style="fill:rgb(193,72,37);" />
                            <path id="mouth_5" d="M35.202,75.377C35.202,75.377 37.421,64.423 52.601,64.17C67.414,63.922 73.245,70.671 73.949,75.347" style="fill:none;stroke:white;stroke-width:5px;" />
                            </g>
                            <g id="base">
                            <ellipse id="eye_r" cx="29.31" cy="42.488" rx="3.922" ry="3.923" style="fill:white;" />
                            <ellipse id="eye_l" cx="75.706" cy="42.488" rx="3.922" ry="3.923" style="fill:white;" />
                            </g>
                            </svg>
                        </div>


                    </div>
                

                    <div class="col-md-8">
                        <h3 class="mt-5"> <b>Signos Vitales</b></h3>
                        <div class="row m-0">
                            <div class="col-md-3 p-1">
                                <div class="form-group row m-0">
                                    <label for="peso" class="col-3 p-1 m-auto col-form-label"><b>Peso:</b></label>
                                    <div class="col-5 p-1 m-auto">
                                        <input type="text" class="form-control" id="peso" maxlength="6" placeholder="">
                                    </div>
                                    <label for="peso" class="col-4 p-1 m-auto col-form-label">Kg</label>
                                </div>
                            </div>
                            <div class="col-md-3 p-1">
                                <div class="form-group row m-0">
                                    <label for="talla" class="col-4 p-1 m-auto col-form-label"><b>Talla:</b></label>
                                    <div class="col-8 p-1 m-auto">
                                        <input type="text" class="form-control" id="talla" maxlength="5" placeholder="">
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 p-1">
                                <div class="form-group row m-0">
                                    <label for="temp" class="col-4 p-1 m-auto col-form-label"><b>Temp:</b></label>
                                    <div class="col-5 p-1 m-auto">
                                        <input type="text" class="form-control" id="temp" maxlength="5" placeholder="">
                                    </div>
                                    <label for="temp" class="col-3 p-1 m-auto col-form-label">°C</label>
                                </div>
                            </div>
                            <div class="col-md-3 p-1">
                                <div class="form-group row m-0">
                                    <label for="fresp1" class="col-4 p-1 m-auto col-form-label"><b>F.Resp:</b></label>
                                    <div class="col-5 p-1 m-auto">
                                        <input type="text" class="form-control" id="fresp1" maxlength="3" placeholder="">
                                    </div>
                                    <label for="fresp1" class="col-3 p-1 m-auto col-form-label">rpm</label>
                                </div>
                            </div>

                            <div class="col-md-4 p-2">
                                <div class="form-group row m-0">
                                    <label for="fcard1" class="col-4 p-1 m-auto col-form-label"><b>F.Card:</b></label>
                                    <div class="col-5 p-1 m-auto">
                                        <input type="text" class="form-control" id="fcard1" maxlength="3" placeholder="">
                                    </div>
                                    <label for="fcard1" class="col-3 p-1 m-auto col-form-label">ppm</label>
                                </div>
                            </div>
                            <div class="col-md-4 p-2">
                                <div class="form-group row m-0">
                                    <label for="ta" class="col-5 p-1 m-auto col-form-label"><b>T.A:</b></label>
                                    <div class="col-3 p-1 m-auto">
                                        <input type="text" class="form-control" id="t" maxlength="5" placeholder="">
                                    </div>
                                    <div class="col-1 p-1 m-auto">/</div>
                                    <div class="col-3 p-1 m-auto">
                                        <input type="text" class="form-control" id="a" maxlength="5" placeholder="">
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4 p-2">
                                <div class="form-group row m-0">
                                    <label for="destrostrix" class="col-7 p-1 m-auto col-form-label"><b>Destrostrix:</b></label>
                                    <div class="col-5 p-1 m-auto">
                                        <input type="text" class="form-control" id="destrostrix" maxlength="3" placeholder="">
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-12 text-right p-2">
                                <button class="btn btn-primary">Guardar</button>
                            </div>
                        </div>
                    </div>


                </div>
            </div>
        </div>
    </div>
</div>

<script src="~/Areas/Admin/assets/js/jquery-3.2.1.min.js"></script>
<script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/gsap/2.1.0/TweenMax.min.js'></script>
<script src='https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js'></script>


<script>
    // Initialization Area
    var painArray = ["YAS", "Yeah", "Mmkay", "Ouch", "Owwwww", "AHHHHHHH"];
    //var painArray = ["Sin Dolor", "Duele un poco", "Duele un poco más", "Duele aún más", "Duele mucho", "El peor dolor"];
    var pain = {}
    for (var i = 0; i < painArray.length; i++) {
        pain[i] = painArray[i];
    }
    var needle = $("#needle");
    var prevFace = ".faces #Ouch";
    var slider = document.getElementById("slider");

    var level = document.getElementById("level");
    //alert(slider.value);
    level.innerHTML = slider.value;

    function findPainLevel(value) {
        var painLevel = Math.floor(value / (Math.round(100 / 6)));
        return painLevel;
    }

    function moveGauge(input) {
        var value = Number(input);
        var maxScale = 943;
        var minScale = 471;
        var maxDegree = 85;
        var scaledValue = ((maxScale - minScale) / 100) * value + minScale;
        var midScale = (maxScale - minScale) / 2 + minScale; // mid is actually rotate 0

        if (scaledValue <= midScale) {
            var rotate = 1;
        }
        else {
            var rotate = -1;
        }

        var scalePerDegree = (midScale - minScale) / maxDegree;
        var rotateValue = (midScale - scaledValue) / scalePerDegree;
        var rotation = rotate * rotateValue;
        //console.log(input,scaledValue ,midScale, rotate, rotation);
        var tl = new TimelineLite();
        tl.to(needle, 1, { rotation: rotateValue });
    }

    function morphFace(painLevel) {
        var mouthExpression;
        mouthExpression = "#mouth_" + painLevel;
        var facialExpression = ".faces #" + pain[painLevel];
        var tl = new TimelineMax();
        tl.to("#mouth_3", 1, { morphSVG: mouthExpression });
        $(prevFace).css("visibility", "hidden");
        $(facialExpression).css("visibility", "visible");
        prevFace = facialExpression;

    }

    slider.oninput = function () {
        $(level).css("visibility", "visible");
        var currentLevel = this.value;
        var painLevel = findPainLevel(currentLevel);
        moveGauge(currentLevel);
        //alert(pain[painLevel]);

        //var painArray = ["YAS", "Yeah", "Mmkay", "Ouch", "Owwwww", "AHHHHHHH"];
        //var painArray = ["Sin Dolor", "Duele un poco", "Duele un poco más", "Duele aún más", "Duele mucho", "El peor dolor"];

        switch (pain[painLevel]) {
            case "YAS":
                level.innerHTML = "Sin Dolor";
                break;
            case "Yeah":
                level.innerHTML = "Duele un poco";
                break;
            case "Mmkay":
                level.innerHTML = "Duele un poco más";
                break;
            case "Ouch":
                level.innerHTML = "Duele aún más";
                break;
            case "Owwwww":
                level.innerHTML = "Duele mucho";
                break;
            default:
                level.innerHTML = "El peor dolor";
        }

        morphFace(painLevel);

    }
</script>


@if (TempData["message_success"] != null)
{
    <script>

        Swal.fire({
            icon: 'success',
            title: 'Nota Guardada',
            showConfirmButton: false,
            timer: 1600
        })

    </script>
}