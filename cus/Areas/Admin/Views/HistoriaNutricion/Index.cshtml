
@{
}

<style>
    .nav-tabs.nav-tabs-bottom > li {
        margin-bottom: -1px;
        width: 110px;
        max-width: 110px;
        font-size: 10px;
    }

    .user-tabs .nav-tabs > li > a {
        padding: 5px;
    }



    .diaginfo {
        position: absolute;
        top: 0;
        left: 0;
        padding: 2px 15px;
        background-color: #20c0f3;
        color: white;
        margin-left: -20px;
        font-size: 15px;
        font-weight: bolder;
    }

        .diaginfo:after {
            content: '';
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            margin: 0 auto;
            width: 0;
            height: 0;
            border-top: solid 30px #20c0f3;
            border-left: solid 50px transparent;
            border-right: solid 50px transparent;
        }


    .diaginfo2 {
        position: absolute;
        top: 0;
        left: 0;
        padding: 2px 15px;
        background-color: #20c0f3;
        color: white;
        margin-left: -20px;
        margin-top: -40px;
        font-size: 12px;
        font-weight: bolder;
    }

        .diaginfo2:after {
            content: '';
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            margin: 0 auto;
            width: 0;
            height: 0;
            border-top: solid 20px #20c0f3;
            border-left: solid 20px transparent;
            border-right: solid 20px transparent;
        }

    .resumenTop {
        position: absolute;
        top: 0;
        left: 0;
        width: 2.5vw;
        height: 2.5vw;
        border-radius: 2.5vw;
        background-color: #20c0f3;
        color: white;
        font-size: 1.2vw;
        line-height: 2.5vw;
        text-align: center;
    }


    .resumenTopCheck {
        position: absolute;
        top: 0;
        right: 0;
        width: 1.5vw;
        height: 1.5vw;
        border-radius: 100%;
        background-color: #20c0f3;
        color: white;
        font-size: 0.8vw;
        line-height: 1.5vw;
        text-align: center;
    }

    .resumenText {
        font-size: 0.8vw;
        margin-top: 3vw;
        color: #9E9E9E;
        font-weight: bolder;
        -moz-box-shadow: none !important;
        -webkit-box-shadow: none !important;
        box-shadow: none !important;
        border: none;
        font-weight: bold;
        border-bottom: 2px solid #FBC43D;
        outline-width: 0;
        width: 100%;
        max-width: 100%;
        background-color: transparent;
    }

    .tipoconsulta {
        border-radius: 0px;
        border: 2px solid #FBC43D;
    }

    .borrardiag {
        width: 50%;
        filter: grayscale(100%);
    }

    .borrarInt {
        width: 50px;
        filter: grayscale(100%);
    }


    #msform input,
    #msform textarea,
    #msform select {
        padding: 10px 8px 4px 8px;
        border: none;
        border-bottom: 1px solid lightgray;
        border-radius: 0px;
        margin-top: 2px;
        width: 100%;
        max-width: 100%;
        box-sizing: border-box;
        color: #20c0f3;
        font-size: 16px;
        letter-spacing: 1px;
        background-color: white;
    }

        #msform input:focus,
        #msform textarea:focus,
        #msform select:focus {
            -moz-box-shadow: none !important;
            -webkit-box-shadow: none !important;
            box-shadow: none !important;
            border: none;
            font-weight: bold;
            border-bottom: 2px solid #20c0f3;
            outline-width: 0
        }


    #notaevolucion {
        background-color: white;
    }

    h1 {
        position: absolute;
        top: 60%;
        left: 0;
        margin: auto;
        right: 0;
        font-size: 1.5em;
    }

    .btn-buscar {
        background-color: #20c0f3;
        color: white !important;
        width: 8%;
    }

        .btn-buscar:hover {
            background-color: #20c0f3 !important;
            color: white !important;
        }

    .btnbuscapac {
        width: 20px;
        -webkit-filter: invert(100%);
        filter: invert(100%);
    }

    .profile-header {
        padding-left: 0px;
        margin-bottom: 20px;
    }
</style>

<div class="page-wrapper">
    <div class="content container-fluid">
        <div class="page-header">
            <div class="row">
                <div class="col-sm-12">
                    <h3 class="page-title">Historia Clínica Nutrición</h3>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-12" id="InfoPX">
                <div class="profile-header">
                    <div class="row align-items-center">
                        <div class="col-auto profile-image">
                            <a href="#">
                            </a>
                        </div>
                        <div class="col ml-md-n2 profile-user-info">
                            <h10 style="font-weight:bold;">Nombre: </h10>
                            <a id="Nombre"></a><br />
                            <h10 style="font-weight:bold;">Expediente: </h10>
                            <a id="Exp"></a><br />
                            <h10 style="font-weight:bold;">Edad: </h10>
                            <a id="Edad"></a><br />
                            <h10 style="font-weight:bold;">Sexo: </h10>
                            <a id="Sexo"></a><br />
                            <h10 style="font-weight:bold;">Fecha Nac.: </h10>
                            <a id="FechaNac"></a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-sm-12" id="BusquedaPX">
                <div class="row">
                    <div class="col-md-12">
                        <h4>Busque al px.</h4>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-3 mb-3">
                        <input type="text" class="form-control BuscarPX" id="NombrePX" placeholder="Nombre PX" required>
                    </div>
                    <div class="col-md-3 mb-3">
                        <input type="text" class="form-control BuscarPX" id="ExpedientePX" placeholder="Expediente PX" required>
                    </div>
                    <div class="col-md-3 mb-2">
                        <button class="btn btn-primary" onclick="BtnBuscarPX()">Buscar</button>
                    </div>
                </div>
                <div>
                    <div class="table-responsive">
                        <table id="TblPaciente" class="datatable table table-stripped">
                            <thead>
                                <tr>
                                    <th style="text-align:center">
                                        Nombre
                                    </th>
                                    <th style="text-align:center">
                                        Primer Apellido
                                    </th>
                                    <th style="text-align:center">
                                        Segundo Apellido
                                    </th>
                                    <th style="text-align:center">
                                        Unidad de Afiliacion
                                    </th>
                                    <th style="text-align:center">
                                        Expediente
                                    </th>
                                    <th style="width:5px">Seleccionar</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="col-sm-12">
                <nav class="user-tabs mb-4">
                    <ul class="nav nav-tabs nav-tabs-bottom nav-justified">
                        <li class="nav-item text-left">
                            <a class="nav-link active" href="#ResultadoLab" data-toggle="tab">Resultado Lab. y<br />Gabinete R.</a>
                        </li>
                        <li class="nav-item text-left">
                            <a class="nav-link" href="#EtapaCam" data-toggle="tab"><span class="med-records">Etapa de<br />Cambio</span></a>
                        </li>
                        <li class="nav-item text-left">
                            <a class="nav-link" href="#DatosDiet" data-toggle="tab">Datos Dietéticos y<br />Estilo de Vida</a>
                        </li>
                        <li class="nav-item text-left">
                            <a class="nav-link" href="#AlimentacionIn" data-toggle="tab">Alimentación<br />Inicial</a>
                        </li>
                        <li class="nav-item text-left">
                            <a class="nav-link" href="#Recordatorio" data-toggle="tab">Recordatorio de 24 hrs.</a>
                        </li>
                        <li class="nav-item text-left">
                            <a class="nav-link" href="#FrecuenciaAlimen" data-toggle="tab">Frecuencia Alimentaria<br />Semanal</a>
                        </li>
                        <li class="nav-item text-left">
                            <a class="nav-link" href="#EvaluacionAntro" data-toggle="tab">Evaluación<br />Antropométrica</a>
                        </li>
                        <li class="nav-item text-left">
                            <a class="nav-link" href="#PlanNutricio" data-toggle="tab">Del Plan<br />Nutricio</a>
                        </li>
                        <li class="nav-item text-left">
                            <a class="nav-link" href="#EducacionIn" data-toggle="tab">Educación<br />Inicial</a>
                        </li>
                        <li class="nav-item text-left">
                            <a class="nav-link" href="#ImpresionDiag" data-toggle="tab">Impresión<br />Diagnóstica</a>
                        </li>
                        <li class="nav-item text-left">
                            <a class="nav-link" href="#Plan" data-toggle="tab">Plan<br />  </a>
                        </li>
                        <li class="nav-item text-left">
                            <a class="nav-link" href="#Pronostico" data-toggle="tab">Pronóstico<br />  </a>
                        </li>
                        <li class="nav-item text-left">
                            <a class="nav-link" href="#Otros" data-toggle="tab">Otros<br />  </a>
                        </li>
                    </ul>
                </nav>

                <div class="tab-content pt-0">

                    <div class="tab-pane fade show active" id="ResultadoLab">
                        <div class="card card-table mb-0 p-3 mb-5">
                            <div class="card-body">
                                <form id="F_Habitus">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label>Buen estado general</label>
                                                <select class="form-control" id="BuenEstadoGral" name="BuenEstadoGral">
                                                    <option value="">Seleccionar</option>
                                                    <option value="Si">Si</option>
                                                    <option value="No">No</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label>Tranquilo</label>
                                                <select class="form-control" id="Tranquilo" name="Tranquilo">
                                                    <option value="">Seleccionar</option>
                                                    <option value="Si">Si</option>
                                                    <option value="No">No</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label>Cooperador</label>
                                                <select class="form-control" id="Cooperador" name="Cooperador">
                                                    <option value="">Seleccionar</option>
                                                    <option value="Si">Si</option>
                                                    <option value="No">No</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label>Orientado</label>
                                                <select class="form-control" id="Orientado" name="Orientado">
                                                    <option value="">Seleccionar</option>
                                                    <option value="Si">Si</option>
                                                    <option value="No">No</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label>Facies caract.</label>
                                                <select class="form-control" id="FaciesCaract" name="FaciesCaract">
                                                    <option value="">Seleccionar</option>
                                                    <option value="Si">Si</option>
                                                    <option value="No">No</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label>Depresivo</label>
                                                <select class="form-control" id="Depresivo" name="Depresivo">
                                                    <option value="">Seleccionar</option>
                                                    <option value="Si">Si</option>
                                                    <option value="No">No</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label>Ansioso</label>
                                                <select class="form-control" id="Ansioso" name="Ansioso">
                                                    <option value="">Seleccionar</option>
                                                    <option value="Si">Si</option>
                                                    <option value="No">No</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label>Agresivo</label>
                                                <select class="form-control" id="Agresivo" name="Agresivo">
                                                    <option value="">Seleccionar</option>
                                                    <option value="Si">Si</option>
                                                    <option value="No">No</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label>Temeroso</label>
                                                <select class="form-control" id="Temeroso" name="Temeroso">
                                                    <option value="">Seleccionar</option>
                                                    <option value="Si">Si</option>
                                                    <option value="No">No</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label>Irritable</label>
                                                <select class="form-control" id="Irritable" name="Irritable">
                                                    <option value="">Seleccionar</option>
                                                    <option value="Si">Si</option>
                                                    <option value="No">No</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label>Marcha</label>
                                                <select class="form-control" id="Marcha" name="Marcha">
                                                    <option value="">Seleccionar</option>
                                                    <option value="Si">Si</option>
                                                    <option value="No">No</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <button id="Btn_Habitus" type="submit" class="btn btn-primary">Guardar</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>


                </div>
            </div>
        </div>
    </div>
</div>

<script src="~/Areas/Admin/assets/js/jquery-3.2.1.min.js"></script>
<script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>

    $(document).ready(function () {

        //Ocultamos div donde se muestra la info del px ya que aún no se ha buscado
        $("#InfoPX").hide();

        var table = $('#TblPaciente').DataTable();
        table.destroy();
        table = $('#TblPaciente').DataTable({
            paging: false,
            scroller: false,
            responsive: true,
            searching: false,
            info: true,
            lengthChange: false,
            pageLength: 20,
            language: {
                "zeroRecords": " ",
                "info": "_TOTAL_ px",
                "search": "Buscar:",
                "infoEmpty": "",
                "paginate": {
                    "first": "Primero",
                    "last": "Último",
                    "next": "Siguiente",
                    "previous": "Anterior",
                },
                "select": {
                    "rows": " %d filas seleccionadas"
                },
            }
        });

        // #region Botones de Guardar HC
        $("#Btn_Habitus").css("display", "none");
        
        // #endregion

        // #region Pestañas: Elementos de la H.C. que nacerán ocultos y se mostrarán hasta que se seleccione o se haga alguna acción
        //habitos
        $("#Combo_TiempoActividadF").css("display", "none");
        
        // #endregion

        //let timerInterval
        //Swal.fire({
        //    title: 'Busque al px. y selecciónalo para crearle la h.c.',
        //    timer: 3500,
        //    timerProgressBar: true,
        //    willClose: () => {
        //        clearInterval(timerInterval)
        //    }
        //});

        
    });

    // #region Pestañas: Elementos de la H.C. que se mostrarán hasta que se seleccione o se haga alguna acción

    //habitos
    $("#ActividadFisica").change(function () {
        var combo = document.getElementById("ActividadFisica");
        var selected = combo.options[combo.selectedIndex].text;
        if (selected == "Si") {
            $("#Combo_TiempoActividadF").css("display", "");
            $("#Combo_FrecuenciaActividadF").css("display", "");
        } else {
            $("#Combo_TiempoActividadF").css("display", "none");
            $("#Combo_FrecuenciaActividadF").css("display", "none");
        }
    });
    

    // #endregion

    //Si dan click en Enter en los inputs de Nombre/Expediente
    $('.BuscarPX').on("keypress", function (e) {
        if (e.keyCode == 13) {
            FuncionBuscarPX();
            return false;
        }
    });

    //Si dan click en el botón de Buscar
    function BtnBuscarPX() {
        FuncionBuscarPX();
    };

    function FuncionBuscarPX() {
	    var NombrePX = $("#NombrePX").val();
	    var ExpedientePX = $("#ExpedientePX").val();

	    Swal.fire({
		    title: 'Cargando... Espere por favor',
		    timer: 1000,
		    timerProgressBar: true,
	    });

	    $.ajax({
		    url: '@Url.Action("BuscarPaciente", "Derechohabiente")',
		    method: 'POST',
		    dataType: 'json',
		    data: {
                NombrePX: NombrePX,
                ExpedientePX: ExpedientePX
		    },
		    success: function(data) {
                if (data.MENSAJE.substring(0, 6) == "Succe:") {
                    LlenaTablaPX(data.PACIENTES);
			    }
			    if (data.MENSAJE.substring(0, 6) == "Error:") {
				    Swal.fire({
					    icon: 'error',
					    title: '¡Error!',
					    text: data.MENSAJE.substring(7),
				    });
			    }
		    },
		    error: function(ex) {
			    Swal.fire({
				    icon: 'error',
				    title: '¡Error!',
			    });
		    }
	    });

    };

    function LlenaTablaPX(PX) {
        var table = $('#TblPaciente').DataTable();
        table.destroy();

        table = $('#TblPaciente').DataTable({
            responsive: true,
            searching: false,
            info: true,
            deferRender: true,
            scroller: false,
            scrollColapse: true,
            paging: false,
            lengthChange: false,
            language: {
                "zeroRecords": "No se encontraron PX",
                "info": "",
                "search": "",
                "infoEmpty": "",
                "paginate": {
                    "first": "Primero",
                    "last": "Último",
                    "next": "Siguiente",
                    "previous": "Anterior",
                },
                "select": {
                    "rows": " %d filas seleccionadas"
                },
            },
            data: PX,
            columns: [
                { 'data': 'Nombre', className: "text-center" },
                { 'data': 'PrimerApellido', className: "text-center" },
                { 'data': 'SegundoApellido', className: "text-center" },
                {
                    "data": "UnidadAfiliacion", className: "text-center", render: function (data, type, row) {
                        if (row.UnidadAfiliacion == 1 ) {
                            return '<h8 style="color:black; ">Unidad habitacional I.</h8>';
                        }
                        if (row.UnidadAfiliacion == 2) {
                            return '<h8 style="color:black; ">Módulo dental Apodaca</h8>';
                        }
                        if (row.UnidadAfiliacion == 3) {
                            return '<h8 style="color:black; ">Pueblo Nuevo</h8>';
                        }
                        if (row.UnidadAfiliacion == 4) {
                            return '<h8 style="color:black; ">Vicente Guerrero</h8>';
                        }
                        if (row.UnidadAfiliacion == 5) {
                            return '<h8 style="color:black; ">San Rafael</h8>';
                        }
                        if (row.UnidadAfiliacion == 6) {
                            return '<h8 style="color:black; ">21 de enero</h8>';
                        }
                        if (row.UnidadAfiliacion == 7) {
                            return '<h8 style="color:black; ">Clínica de atención int.</h8>';
                        }
                        if (row.UnidadAfiliacion == 8) {
                            return '<h8 style="color:black; ">Módulo dental Guadalupe</h8>';
                        }
                        if (row.UnidadAfiliacion == 9) {
                            return '<h8 style="color:black; ">Ciénega de Flores</h8>';
                        }
                    }
                },
                { 'data': 'Expediente', className: "text-center" },
                {
                    "className": 'text-center',
                    "orderable": false,
                    "data": null,
                    "defaultContent": '<button title="Seleccionar px" id="VerDetalle" class="btn btn-success fa fa-check" data-toggle="modal" ></button>',
                    "target": -2
                }
            ]
        });
    }

    $('#TblPaciente tbody').on('click', '#VerDetalle', function () {
        var tr = $(this).closest('tr');
        row = $('#TblPaciente').DataTable().row(tr);

        var Nombre = row.data().Nombre;
        var PrimerA = row.data().PrimerApellido;
        var SegundoA = row.data().SegundoApellido;
        var Exp = row.data().Expediente;
        var Edad = row.data().Edad;
        var Sexo = row.data().Sexo;
        var FechaN = row.data().FechaNacimiento;

        //Dividir fecha de nacimiento
        var splitFechaN = FechaN.split('/');
        const anioNacimiento = parseInt(splitFechaN[2]);
        const mesNacimiento = parseInt(splitFechaN[1]);
        const diaNacimiento = parseInt(splitFechaN[0]);

        // Obtiene la fecha actual
        const fechaActual = new Date();

        // Obtiene el año, mes y día actual
        const anioActual = fechaActual.getFullYear();
        const mesActual = fechaActual.getMonth() + 1; // Los meses en JavaScript van de 0 a 11
        const diaActual = fechaActual.getDate();

        // Calcula la edad
        let edad = anioActual - anioNacimiento;
        let edadMeses = mesActual - mesNacimiento;

        // Verifica si aún no ha llegado el cumpleaños de este año
        if (mesActual < mesNacimiento || (mesActual === mesNacimiento && diaActual < diaNacimiento)) {
            edad--;
        }

        document.getElementById("Nombre").innerHTML = Nombre + " " + PrimerA + " " + SegundoA;
        document.getElementById("Exp").innerHTML = Exp;
        document.getElementById("Edad").innerHTML = edad + ' años ' + edadMeses + ' meses';
        document.getElementById("Sexo").innerHTML = Sexo;
        document.getElementById("FechaNac").innerHTML = FechaN;

        //ocultamos div de la busqueda del px
        $("#BusquedaPX").hide();
        //mostramos div de la info del px
        $("#InfoPX").show();

        // #region Mostrar botones de Guardar HC ya que ya se buscó el px
        $("#Btn_Habitus").css("display", "");
        
        // #endregion
    });

    // #region Guardar cada pestaña/sección


    // #endregion

</script>